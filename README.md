/ 🎨 AstrBot NewImage Plugin

> AI 图像生成插件 - 支持图生图、文生图、40+ 预设风格转换

一款功能强大的 AstrBot 图像生成插件，支持通过 OpenAI 兼容 API 进行图生图（手办化、Q版化、Cos化等 40+ 预设）和文生图创作。内置用户/群组次数限制系统与每日签到机制，适合社群运营使用。

// ✨ 功能特性

/// 🖼️ 图生图功能
- **40+ 预设风格**：手办化、Q版化、Cos化、痛车化、痛屋化、真人化等多种风格转换
- **多种输入方式**：
  - 直接发送图片 + 指令
  - 回复带图片的消息 + 指令
  - @用户 + 指令（使用其头像）
- **自定义 Prompt**：使用 `bnn <提示词>` 进行完全自定义创作
- **批量处理**：自定义模式支持最多 5 张图片同时处理

/// ✏️ 文生图功能
- 使用 `/文生图 <描述>` 直接从文字生成图像

/// 🎁 次数管理系统
- **用户次数限制**：按 QQ 号独立计算使用次数
- **群组次数限制**：按群号计算群内共享次数
- **每日签到**：发送「辉宝赐福」获取免费次数
- **随机/固定奖励**：可配置签到奖励模式

/// 🔐 权限管理
- **黑白名单**：支持用户/群组级别的黑白名单
- **管理员豁免**：管理员不受次数限制
- **并发控制**：可限制单个群聊同时处理的任务数

/// 🔧 管理功能
- **API Key 轮换**：支持多 Key 自动轮换使用
- **动态预设管理**：通过指令添加/修改预设
- **代理支持**：内置网络代理配置

---

// 📦 安装

/// 方式一：通过 AstrBot 插件市场安装（推荐）
在 AstrBot 管理面板的「插件市场」中搜索 `newimage` 进行安装。

/// 方式二：手动安装
1. 下载本仓库
2. 将 `astrbot_plugin_newimage` 文件夹放入 AstrBot 的 `data/plugins/` 目录
3. 重启 AstrBot

---

// ⚙️ 配置说明

在 AstrBot 管理面板的「插件管理」中找到本插件进行配置。

/// 🌟 推荐配置方式：选择提供商

本插件支持直接选择 AstrBot 中已配置的提供商，无需重复填写 API URL 和 Key！

| 配置项 | 类型 | 说明 |
|--------|------|------|
| `provider_id` | 下拉选择 | 从 AstrBot 已配置的提供商列表中选择一个 |
| `model` | 字符串 | **必填**，生图模型名称，如 `google/gemini-2.0-flash-exp:free` |

> 💡 **提示**：选择提供商后，插件会自动使用该提供商的 API URL 和 Key，非常方便！

/// 手动配置方式

如果不选择提供商，也可以手动配置 API：

| 配置项 | 类型 | 说明 |
|--------|------|------|
| `api_url` | 字符串 | API 地址，支持 OpenRouter、OpenAI 兼容接口 |
| `api_keys` | 列表 | API 密钥列表，支持多个 Key 轮换 |

/// 其他配置

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `prefix` | 开关 | `true` | 是否要求指令带前缀（`/` 或 `@机器人`） |
| `extra_prefix` | 字符串 | `bnn` | 自定义 Prompt 模式的触发词 |
| `use_proxy` | 开关 | `false` | 是否启用代理 |
| `proxy_url` | 字符串 | - | 代理地址 |
| `enable_user_limit` | 开关 | `true` | 是否启用用户次数限制 |
| `enable_group_limit` | 开关 | `false` | 是否启用群组次数限制 |
| `group_task_limit` | 整数 | `2` | 单群同时处理任务数限制 |
| `enable_checkin` | 开关 | `false` | 是否开启签到功能 |
| `checkin_fixed_reward` | 整数 | `3` | 签到固定奖励次数 |

---

// 📖 命令列表

/// 🎨 图生图预设指令

| 命令 | 功能说明 |
|:-----|:---------|
| `/手办化` ~ `/手办化6` | 6 种不同风格的手办模型生成 |
| `/Q版化` | 生成 Q 版（可爱大头）角色 |
| `/cos化` | 生成 Cosplay 风格照片 |
| `/cos自拍` | 生成 Cos 自拍风格 |
| `/痛车化` | 生成痛车（车身贴图）效果 |
| `/痛屋化` / `/痛屋化2` | 生成痛屋（角色主题房间）效果 |
| `/真人化` / `/真人化2` | 动漫角色真人化 |
| `/半真人` | 半写实半动漫混合风格 |
| `/半融合` | 真人与动漫融合效果 |
| `/玩偶化` | 生成 Fumo 毛绒玩偶风格 |
| `/贴纸化` | 生成贴纸风格 |
| `/挂件化` | 生成挂件/钥匙扣风格 |
| `/微型化` | 生成微缩模型效果 |
| `/3D打印` | 生成 3D 打印模型预览 |
| `/第一视角` | 第一人称视角场景 |
| `/第三视角` | 第三人称视角场景 |
| `/孤独的我` | 孤独意境图 |
| `/cos相遇` | 角色与 Coser 相遇场景 |
| `/鬼图` | 灵异风格图片 |
| `/玉足` | 角色足部特写 |
| `/三视图` | 角色正侧背三视图 |
| `/穿搭拆解` | 服装穿搭详细拆解 |
| `/拆解图` | 模型零件拆解展示 |
| `/角色界面` | 游戏风格角色信息界面 |
| `/角色设定` | 角色设定图（含表情、动作等） |
| `/姿势表` | 多姿势参考表 |
| `/高清修复` | 图片高清化修复 |
| `/人物转身` | 人物转身连续画面 |
| `/绘画四宫格` | 绘画过程四宫格展示 |
| `/发型九宫格` | 9 种发型对比 |
| `/头像九宫格` | 9 种头像风格 |
| `/表情九宫格` | 9 种表情对比 |
| `/多机位` | 多角度镜头合集 |
| `/电影分镜` | 电影风格分镜图 |
| `/动漫分镜` | 动漫风格分镜图 |

/// ✏️ 文生图与自定义

| 命令 | 功能说明 |
|:-----|:---------|
| `/文生图 <描述>` | 纯文本描述生成图片 |
| `bnn <提示词>` | 自定义 Prompt 图生图（支持多图） |

/// 🎁 签到与查询

| 命令 | 功能说明 |
|:-----|:---------|
| `辉宝赐福` | 每日签到获取次数（无需前缀） |
| `/生图查询次数` | 查询个人/群组剩余次数 |
| `/生图帮助` | 查看所有预设列表 |
| `/生图帮助 <预设名>` | 查看指定预设的 Prompt 内容 |

/// 👑 管理命令（仅管理员）

| 命令 | 功能说明 |
|:-----|:---------|
| `/预设添加 <名称>:<提示词>` | 添加/修改预设 |
| `/生图增加用户次数 @用户 <次数>` | 为用户增加次数 |
| `/生图增加用户次数 <QQ号> <次数>` | 为用户增加次数 |
| `/生图增加群组次数 <群号> <次数>` | 为群组增加次数 |
| `/生图添加key <key1> [key2...]` | 添加 API 密钥 |
| `/生图key列表` | 查看密钥列表 |
| `/生图删除key <序号\|all>` | 删除密钥 |

---


// 📝 更新日志

/// v1.2.0 (2026-01-07)
- ✨ **新功能**：支持从 AstrBot 提供商列表中选择 API 提供商（下拉选择，无需手动填写 URL 和 Key）
- ✨ **优化**：配置界面更加直观，优先使用提供商选择，也支持手动配置
- 📝 **文档**：更新配置说明，新增提供商选择使用指南

/// v1.1.0 (2026-01-07)
- 🐛 **修复**：用户次数限制逻辑错误，现在次数为 0 时正确拒绝请求
- 🐛 **修复**：「辉宝赐福」签到命令现在可以直接发送触发，无需前缀
- ✨ **优化**：指令名称更加直观（`lm帮助` → `生图帮助`，`lm添加` → `预设添加`）
- 📝 **文档**：完善插件帮助信息和命令描述

/// v1.0.0
- 🎉 初始版本发布
- 支持 40+ 图生图预设
- 支持文生图功能
- 用户/群组次数限制系统
- 每日签到功能

---

// 🔧 常见问题

/// Q: 如何配置 API？（推荐方式）
A:
1. 确保已在 AstrBot 的「提供商管理」中配置好支持图像生成的提供商（如 OpenRouter）
2. 在本插件配置页面的「选择生图API提供商」下拉框中选择该提供商
3. 填写 `model` 为支持图像生成的模型名称（如 `google/gemini-2.0-flash-exp:free`）
4. 保存配置即可

/// Q: 签到命令没反应？
A: 请确保在插件配置中开启了 `enable_checkin` 选项。

/// Q: 用户明明没次数了还能画图？
A: 这是旧版本的 Bug，请更新到 v1.1.0 以上版本。

/// Q: 如何手动配置 OpenRouter？
A: 如果不使用提供商选择功能，也可以手动配置：
1. 在 [OpenRouter](https://openrouter.ai/) 注册账号并获取 API Key
2. 将 `api_url` 设置为 `https://openrouter.ai/api/v1/chat/completions`
3. 将 `model` 设置为支持图像生成的模型，如 `google/gemini-2.0-flash-exp:free`
4. 在 `api_keys` 中添加你的 API Key

---

// 🙏 致谢

本插件在以下优秀项目的基础上开发，感谢原作者的无私贡献！

- **shskjw** - astrbot_plugin_siliconflow-shouban
  - 提供了插件的核心架构和预设系统
  
- **喵喵** - gemini-25-image-openrouter
  - 提供了 OpenRouter API 适配方案和图像响应解析逻辑

- **维拉大佬**
  - 提供了原始的 JavaScript 版本实现

同时感谢 [AstrBot](https://github.com/Soulter/AstrBot) 项目提供的强大插件框架！

---

// 📄 开源协议

本项目采用 [AGPL-3.0](LICENSE) 协议开源。

---

**Made with ❤️ by Nova for 辉宝主人**